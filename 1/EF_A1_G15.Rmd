---
title: "EF Group Submission Assignment 1"
subtitle: "Group 15" 
author: "Lanlan Hou (2801069), Rick van der Ploeg (2782774), Sebastiaan van Dijen (2769505) and Alfred Sou (2796840)"
output: pdf_document
---

# Question 1

## a.
```{r echo=TRUE,fig.dim=c(5,4),fig.align='center'}
library(openxlsx)
raw <- read.xlsx('student_groups_stocks.xlsx', sheet = 1)

groupNumber <- 15
nameOfStock <- raw$Stock.Name[groupNumber]
startDate <- raw$Start.Date[groupNumber]
endDate <- raw$`End.Date.(+10y)`[groupNumber]

library(quantmod)
getSymbols(nameOfStock, src = 'yahoo', from = startDate, to = endDate)
date <- index(HSBC)
adjustedPrice <- as.numeric(HSBC[,'HSBC.Adjusted'])

# Simple Returns
differencePrice <- diff(adjustedPrice)
simpleReturns <- numeric(length(adjustedPrice) - 1)
for(i in (1:length(adjustedPrice)-1)){
  simpleReturns[i] <- differencePrice[i] / adjustedPrice[i] * 100
}

# Log Returns
compoundedReturns <- numeric(length(adjustedPrice) - 1)
for(i in (2:length(adjustedPrice))){
  compoundedReturns[i-1] <- adjustedPrice[i] / adjustedPrice[i-1]
}

library(ggplot2)
prices_df <- data.frame(date = date, adjustedPrice = adjustedPrice)
returns_df <- data.frame(date = date[2:length(date)], simpleReturns = simpleReturns, compoundedReturns = compoundedReturns)

plot(date, adjustedPrice, type = 'l', 
     main = paste('Adjusted Close Price of', nameOfStock),
     xlab = 'Year', ylab = 'Adjusted Close Price',
     col = 'blue', lwd = 1)
ggplot(prices_df, aes(x = date, y = adjustedPrice)) +
  geom_line(color = "blue", linewidth = 1) +
  labs(
    title = paste("Adjusted Close Price of", nameOfStock),
    x = "Year",
    y = "Adjusted Close Price"
  ) +
  theme_minimal()
ggsave('figures/prices_plot.png', dpi = 300)

plot(date[2:length(date)], simpleReturns, type = 'l', 
     main = paste('Simple Returns of', nameOfStock),
     xlab = 'Year', ylab = 'Simple Returns',
     col = 'blue', lwd = 1)
ggplot(returns_df, aes(x = date, y = simpleReturns)) +
  geom_line(color = "blue", linewidth = 1) +
  labs(
    title = paste('Simple Returns of', nameOfStock),
    x = 'Year',
    y = 'Simple Returns'
  ) +
  theme_minimal()

plot(date[2:length(date)], compoundedReturns, type = 'l', 
     main = paste('Log Returns of', nameOfStock),
     xlab = 'Year', ylab = 'Log Returns',
     col = 'blue', lwd = 1)
ggplot(returns_df, aes(x = date, y = compoundedReturns)) +
  geom_line(color = "blue", linewidth = 1) +
  labs(
    title = paste('Log Returns of', nameOfStock),
    x = 'Year',
    y = 'Log Returns'
  ) +
  theme_minimal()
ggsave('figures/returns_plot.png', dpi = 300)
```

## b.
```{r echo=TRUE,fig.dim=c(5,4),fig.align='center'}

price_mean <- mean(adjustedPrice)
price_stdev <- sd(adjustedPrice)
price_minimum <- min(adjustedPrice)
price_maximum <- max(adjustedPrice)
price_median <- median(adjustedPrice)
price_10_percentile <- quantile(adjustedPrice, 0.1)
price_90_percentile <- quantile(adjustedPrice, 0.9)

price_summaryStatistics <- data.frame(
  Statistics = c("Mean", "Std. Deviation", "Minimum", "P10", "Median", "P90", "Maximum"),
  Values = round(c(price_mean, price_stdev, price_minimum, price_10_percentile, price_median, price_90_percentile, price_maximum), 6)
)

price_summaryStatistics

logReturns_mean <- mean(compoundedReturns)
logReturns_stdev <- sd(compoundedReturns)
logReturns_minimum <- min(compoundedReturns)
logReturns_maximum <- max(compoundedReturns)
logReturns_median <- median(compoundedReturns)
logReturns_10_percentile <- quantile(compoundedReturns, 0.1)
logReturns_90_percentile <- quantile(compoundedReturns, 0.9)

logReturns_summaryStatistics <- data.frame(
  Statistics = c("Mean", "Std. Deviation", "Minimum", "P10", "Median", "P90", "Maximum"),
  Values = round(c(logReturns_mean, logReturns_stdev, logReturns_minimum, logReturns_10_percentile, logReturns_median, logReturns_90_percentile, logReturns_maximum), 6)
)

logReturns_summaryStatistics
```

# Question 2

## a.
```{r echo=TRUE, fig.dim=c(5,4),fig.align='center'}
single_logReturns_df <- data.frame(compoundedReturns = compoundedReturns)

ggplot(single_logReturns_df, aes(x = compoundedReturns)) +
  geom_histogram(aes(y = ..density..), 
                 bins = 50, fill = "blue", color = "white") +
  stat_function(fun = dnorm,
                args = list(mean = mean(single_logReturns_df$compoundedReturns, na.rm = TRUE),
                            sd = sd(single_logReturns_df$compoundedReturns, na.rm = TRUE)),
                color = "red", linewidth = 1.2) +
  labs(title = "Distribution of Log Returns",
       x = "Log Returns", y = "Density") +
  theme_minimal()
ggsave('figures/returns_distribution.png', dpi = 300)
```

## b.
```{r echo=TRUE, fig.dim=c(12,8)}
library(tseries)

jb_test <- jarque.bera.test(compoundedReturns)
jb_test

jbTest_summaryStatistics <- data.frame(
  JB_Test_Statistic = round(jb_test$statistic, 2),
  Critical_Value = round(qchisq(0.95, 2), 2),
  p_Value = round(jb_test$p.value, 2) 
)

jbTest_summaryStatistics

ggplot(single_logReturns_df, aes(sample = compoundedReturns)) +
  stat_qq(shape = 1, color = 'blue', size = 1) +
  stat_qq_line(color = 'red', linewidth = 1) +
  labs(title = 'QQ Plot for HSBC Log Returns',
       x = 'Theoretical Quantiles', y = 'Sample Quantiles') +
  theme_minimal()
ggsave('figures/returns_qqplot.png', dpi = 300)
```